# 2 章 システム固有の値を表現する「値オブジェクト」

## 2-1 値オブジェクトとは

[サンプルコード](https://github.com/miily8310s/ddd-bottomup/blob/feat/chap2/chap2/SampleCodes/2-1.ts)

- 値オブジェクト = システム固有の値を表現するために定義されたオブジェクト
  - システムに最適な値は必ずしもプリミティブ（単純）な値であるとは限らない
  - サンプルコードの FullName クラスは、値にもオブジェクトにも当てはまる値オブジェクトの一例

## 2-2 値の性質と値オブジェクトの実装

[サンプルコード](https://github.com/miily8310s/ddd-bottomup/blob/feat/chap2/chap2/SampleCodes/2-2.ts)

- 値がもつ性質を学ぶことは値オブジェクトを知る上で重要な事柄
- 代表的な値の性質は次の 3 つ
  - 不変である
  - 交換が可能である
  - 等価性によって比較される
- 値オブジェクトは値の一種なので、上記値の性質も適用される

### 交換が可能である

- 値は不変であるが、ソフトウェアを作る上で値を変更せずに目的を達成することは困難
- 交換（代入）なら値の変更ができる
- サンプルコードはすべて代入によって値オブジェクトの値を変更している

### 等価性によって比較される

- 値の比較は左辺と右辺でインスタンスとして別個のものだが、値を構成する属性によって、
  比較される（=等価として判定されることもある ）
- 値オブジェクトは値と同じように値オブジェクト同士で比較できる方が自然
- 値オブジェクトのクラスで比較メソッド（今回のサンプルコードだと equals メソッド）があることで、値オブジェクトに新たな属性が追加されてもこのクラス内のメソッドの修正だけで済む
  - 比較処理だけでなく値を操作する処理は値オブジェクトのクラスが提供してまとめる

## 2-3 値オブジェクトにする基準

- FullName クラスを構成する firstName や lastName 属性は値オブジェクトではなく、プリミティブな文字型列
- システムに登場する概念のうち、どこまでを値オブジェクトにするかは難しい
  - 単純にドメインモデルとして定義される概念は値オブジェクトに定義される
- ドメインモデルとして挙げられなかった概念を値オブジェクトにすべきかの判断基準は２つ
  - そこにルールが存在しているか
  - それ単体で取り扱いたいか
- サンプルコードでは
  - 氏名には「姓と名で構成される」　のルールが存在するので、値オブジェクトになる
  - 姓や名は「使用可能な文字種が制限される」のルールを作ることができる
    - こちらは値オブジェクトにしなくてもしても実現できる
    - 値オブジェクトにした場合はサンプルコードの Name クラスの書き方ができる

## 2-4 ふるまいを持った値オブジェクト

[サンプルコード](https://github.com/miily8310s/ddd-bottomup/blob/feat/chap2/chap2/SampleCodes/2-4.ts)

- 値オブジェクトで重要なこと=「独自のふるまいを定義できること」
- 今回はお金を表現するお金オブジェクトで考えてみる
  - お金には量と通貨単位（例：ドル、円）の２つの属性がある
  - サンプルコードは Money クラス
    - 独自のふるまいとしてお金を加算する Add メソッドを定義
    - 通貨単位が異なる場合はエラーを投げる

### 定義されないからこそわかること

- オブジェクトに定義されるふるまいは、そのオブジェクトができることを示す
  - = 逆に定義されていないふるまいは、オブジェクトではできない
