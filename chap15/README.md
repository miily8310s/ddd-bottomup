# 第１５章　 ドメイン駆動設計のとびらを開こう

- 今後の学習の手引きをする
- ドメインの値を表現する「値オブジェクト」から「エンティティ」「ドメインサービス」などにフォーカスしながら確認してきた
- それと並行してひとつのソフトウェアを作り上げる過程にも触れてきた
- ドメイン駆動設計はモデリング手法とそのモデルをコードへ落とし込むための実践的なパターンをまとめたプラクティス

## 15-1 軽量 DDD に陥らないために

- 軽量 DDD：ドメイン駆動設計に登場するパターンだけを取り入れる手法
  - コードの書き方が主題
  - 開発者だけで完結が可能
  - パターンを踏襲することだけで満足してしまう
- しかしドメイン駆動設計が目指すことは決してパターンに終始することではない
- 最も重要なことはドメインの本質に向き合うこと
  - 技術的なパターンはドメインの本質に向き合い、それを上手くコードで表現するためのサポート
- ドメイン駆動設計は、ドメインを実装に結びつけるモデリングの手法についても多く語られている
- モデリングの手法のうち、代表的な概念に触れていく

## 15-2 ドメインエキスパートとモデリングをする

- システム開発においては荒唐無稽な認識のズレがよく起こりえる
- より複雑で繊細な概念になってくると、開発者がシステムに実直な言葉を使うほど、聞かされるドメインの精通者は理解を放棄するようになる
- こうした理解の放棄は、最終的にドメインとコードの断絶という結果に行き着く
  - プロダクトのコードも開発者の理解と言葉によって組み立てられる
- 開発者はドメインエキスパート（ドメインの精通者）たちと会話しなくてはいけない ※ステークホルダーのことではない
- ドメインをよく知るには彼らの世界や、見えている景色を知る必要がある
  - ドメインの概念を捻じ曲げないように、共通の言葉でコミュニケーションすべき
  - ドメインの問題解決の答えを出すには → ドメインを知る

### 本当に解決すべきものを見つけよう

- ドメインエキスパートとの対話はソフトウェアの方向性を決定するのに有意義
  - ただし開発者がドメインエキスパートに迎合（げいごう）するばっかりするのは非推奨
- 開発者がドメインエキスパートと協力して有益な概念を作りあげなければいけない
  - 有益な概念=ドメインモデル
- ただしドメインエキスパートはドメインモデルや持っている知識がシステムのどこに役に立つかまではわからない
  - システムによって実現できることに関する知識が必要
  - 開発者には彼らとの対話を手引し、システムにとって役立つ概念や知識を引き出す使命がある
  - ドメインエキスパートと開発者が協力しながら知識を蒸留することで、ドメインの概念から知識が選びぬかれ、ドメインモデルへと昇華する

### ドメインとコードを結びつけるモデル

- ソフトウェア開発の最終成果物はコード
- ドメインに対する気付きは対話の場ではなく、設計や実装の段になって表れることもある
- ドメインとコードはモデルを通じて繋げることができる
- そしてお互いを行き来することで、ソフトウェアに役たち、ドメインの知識を凝縮したドメインモデルを手に入れることができる

## 15-3 ユビキタス言語

- 例として同一の動作を指す「ユーザを登録する」を挙げてみる
  - ドメインエキスパートは「ユーザを登録する」、開発者は「ユーザを新規保存する」と表現
- ドメインエキスパートと開発者がまったく異なる言葉で会話することは、大変な障害になる
  - 開発者はドメインエキスパートから価値あるドメインを引き出さなければいけない
  - そのため同じ言葉でお互い会話する必要がある
- ユビキタス言語：プロジェクトにおいて認識の齟齬や翻訳にコストをかけないための共通言語
  - ドメインエキスパートとの会話、開発者同士の会話、コード上でも使われる
  - 決してドメインエキスパートの言葉をそのまま扱うことではない
- ドメインエキスパート/開発者の双方でユビキタス言語を改良していく
  - 会話するうちに言葉の定義が不正確・曖昧なことが発覚するため
  - 改良し合うことでドメインの知識も深まる

### 深い洞察を得るために

- モデルに対する不快洞察を得るためにはユビキタス言語による会話が重要なファクターとなる
- ユビキタス言語が浸透していないプロジェクトは常に翻訳している状態
  - ドメインエキスパートは独自の専門用語で会話する
  - 開発者はそれを自分たちの言葉に翻訳することに躍起に
- ユビキタス言語を（最初は慣れないかもしれないが）使い会話をしていくと、ドメインの概念を伝える際に扱い肉用語や曖昧な言葉に気づくことがある
  - これが深い洞察のきっかけ
- どうして扱いにくいか、何が曖昧なのかを開発者とドメインエキスパートと指摘し合う
  - → ドメインモデルは深い洞察をもって洗練・ドメインの知識を語るようになる

### ユビキタス言語がコードの表現として使われる

- ユビキタス言語はいたるところで利用される
  - 会話・ドキュメントだけでなくコードにも登場する
- 「ユーザの名前を変更する」という表現がドメインにとって自然な表現であれば、「名前を変更する」言葉を忠実にコードで表現すべき
- コードがドメインモデルをそのまま表現できていれば、ドメインの変化はそのままコードへ適用できる
- ユビキタス言語を利用することは設計とコードを結びつける大切な作業
