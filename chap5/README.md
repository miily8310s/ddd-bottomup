# ５章 データにまつわる処理を分離する「リポジトリ」

- リポジトリは永続化や再構築を担う
- オブジェクトの永続化（保存）や再構築（復元）といった操作は重要だが、データストアを操作するコードはプラグラムの意図をぼやけさせる
- 意図を明確にするにはデータストアにまつわる処理を切り離すことが必要
- リポジトリはそういった操作を抽象的に扱えるようにし、処理の意図を明確にさせる
  - データストアにまつわる処理がリポジトリに寄るため、データストアの差し替えも実現できる
  - テスト実行も容易になる
- リポジトリはソフトウェアの柔軟性に寄与する重要なパターン

- ※ データストア：DB などデータを溜めておく場所のこと

## 5-1 リポジトリとは

- ソフトウェア開発の文脈におけるリポジトリ=データの保管庫
- オブジェクトを繰り返し利用するには、何らかのデータストアにオブジェクトのデータを永続化（保存）し、再構築（復元）する必要がある
- リポジトリはこの「データを永続化（保存）し、再構築（復元）する」処理を抽象的に扱うためのオブジェクト
- オブジェクトのインスタンスを保存したいときは
  - X 直接データストアに書き込みを行う処理を実行する
  - ○ リポジトリにインスタンスの永続化を依頼する

## 5-2 リポジトリの責務

- リポジトリの責務はドメインオブジェクトの永続化と再構築を行うこと
- 永続化=インスタンスを保存し、復元できるようにすること
- 永続化を行う技術基盤の例）
  - リレーショナルデータベース
  - データを保存するファイル
  - NoSQL データベース
- 永続化を実施するために記述される特定のデータストアに基づく具体的な手順は大抵ややこしい
- 第４章 4-4 で出てきたユーザー作成処理を改めてここで確認
  - コードの前半部分でユーザー生成と重複確認を行っている点は確認しやすい
  - 後半部分では
    - リレーショナルデータベースの操作を行っていることは読み取れる
    - しかし User オブジェクトのインスタンスを保存していることまではすぐ読み取れない状態
  - コードの大半をデータストアの具体的な操作に追われてしまっており、趣旨が読み取りづらくなってしまっている
- ユーザ作成処理をリポジトリを利用した実装に書き換えてみる

**TODO：サンプルコード作成**
